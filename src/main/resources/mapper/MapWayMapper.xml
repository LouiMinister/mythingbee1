<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.antybeety.map.way.mybatis.MapWayMapper">

    <resultMap id="node_info" type="com.antybeety.map.way.model.vo.NodeVO">
        <id property="id" column="node_id" jdbcType="INTEGER"/>
        <id property="lat" column="lat" jdbcType="DOUBLE"/>
        <id property="lng" column="lon" jdbcType="DOUBLE"/>
    </resultMap>

    <resultMap id="edge_info" type="com.antybeety.map.way.model.vo.EdgeVO">
        <id property="id" column="edge_id" jdbcType="INTEGER"/>
        <id property="nodeStart" column="node_s" jdbcType="INTEGER"/>
        <id property="nodeEnd" column="node_e" jdbcType="INTEGER"/>
        <id property="address" column="addr" jdbcType="VARCHAR" />
        <id property="safeVal" column="safe_value" jdbcType="INTEGER" />
        <id property="distanceVal" column="dist_value" jdbcType="INTEGER"/>
    </resultMap>

<!--    모든 노드(교차로 + 속도 변화 구간) 정보 가져오기 -->
    <select id="getAllNode" parameterType="hashmap" resultMap="node_info">
        SELECT node_id, lat, lon FROM node_tb
    </select>

    <select id="getAllEdge" parameterType="hashmap" resultMap="edge_info">
        SELECT edge_id, node_s, node_e FROM edge_tb
    </select>

    <insert id="addNode" parameterType="hashmap" statementType="PREPARED">
        insert into node_tb (node_id, lat, lon) values(${index}, ${lat}, ${lon})
    </insert>

    <insert id="addEdge"  parameterType="hashmap">
        insert into edge_tb (edge_id, node_s, node_e, dist_value) values(${index}, ${startNode}, ${endNode}, #{distance})
    </insert>

    <delete id="deleteNode">
        delete from node_tb where node_id = ${index} ;
    </delete>

    <delete id="deleteEdge">
        delete from edge_tb where edge_id = ${index} ;
    </delete>

    <select id="searchNodeByArea" parameterType="hashmap" resultMap="node_info">
        select * from node_tb where lat &gt;= ${lat1} AND lat &lt;= ${lat2} AND lon &gt;= ${lng1} AND lon &lt;= ${lng2}
    </select>

    <select id="searchNodeById" parameterType="java.lang.String" resultMap="node_info">
        select * from node_tb where node_id=#{id};
    </select>
</mapper>